<div class="container-fluid dataTable-content--wrapper">
    <div class="row">
        <div class="col-xs-12 col-sm-12">
            <div class="row">
                <div class="col-xs-12 col-sm-4">
                    <div class="dataTable--left_wrapper">
                        <h2 class="dataTable-title">{{ $ctrl.batch.batch_number}}</h2>
                        <p><span class="orange-txt">{{ $ctrl.batch.created_at }}</span> </p>
                    </div>
                </div>
            </div>
            <div class="tab-content">
                <div id="bill" class="tab-pane fade in active">
                    <div class="viewData-wrapper">
                        <div class="viewData-toggle--wrapper">
                            <div class="viewData-toggle--wrapper">
                                <div class="viewData-toggle--inner">
                                    <h2 class="viewData-toggle--title pull-left">
                                        {{$ctrl.asp.title_name}}
                                    </h2>
                                    <span class="viewData-toggle--btn pull-right"><i class="fa fa-angle-down" aria-hidden="true"></i></span>
                                    <div class="clearfix"></div>
                                    <ul>
                                        <li>ASP Code : <span>{{$ctrl.asp.asp_code}}</span></li>
                                        <li ng-if="$ctrl.asp.asp_code != 'NULL'">ASP Type :
                                            <span>
                                                {{$ctrl.asp.is_self ? 'Self' : 'Non Self'}}
                                            </span>
                                        </li>
                                        <li ng-if="$ctrl.asp.asp_code != 'NULL'">ASP has GST :
                                            <span>
                                                {{$ctrl.asp.has_gst ? 'Yes' : 'No'}}
                                            </span>
                                        </li>
                                        <li ng-if="$ctrl.asp.is_self && $ctrl.asp.has_gst">Auto Invoice :
                                            <span>
                                                {{$ctrl.asp.is_auto_invoice ? 'Yes' : 'No'}}
                                            </span>
                                        </li>
                                        <li>Tier :
                                            <span>
                                                {{$ctrl.asp.tier}}
                                            </span>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                    <div class="viewData-threeColumn--wrapper">
                                        <div class="row">
                                            <div class="col-xs-12 col-sm-4">
                                                <ul class="viewData-threeColumn--group">
                                                    <li><img src="./resources/assets/images/ic-location.svg"></li>
                                                    <li>
                                                        <p>
                                                            {{$ctrl.asp.workshop_name}} <br>
                                                            {{$ctrl.asp.address_line_1}}<br>
                                                            {{$ctrl.asp.address_line_2}}<br>
                                                        </p>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="col-xs-12 col-sm-4">
                                                <ul class="viewData-threeColumn--group">
                                                    <li><img src="./resources/assets/images/ic-phone.svg"></li>
                                                    <li>
                                                        <p>{{$ctrl.asp.contact_number1}}<br><a href="javascript:;">{{$ctrl.asp.email}}</a></p>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="col-xs-12 col-sm-4">
                                                <ul class="viewData-threeColumn--group">
                                                    <li><img src="./resources/assets/images/ic-profile.svg"></li>
                                                    <li>
                                                        <p>RM: {{$ctrl.asp.rm.name}}<br> RM Mobile: {{$ctrl.asp.rm.contact_number}} </p>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        @if(count($attachments) > 0)
                        <div class="formTabs-wrapper">
                            <label class="heading-label">{{isset($title) ? $title : 'Attachments'}}</label>
                            <div class="formTabs-inner">
                                <div class="row">
                                    @foreach($attachments as $key => $attachment)
                                    <div class="attachmentlabel">
                                        <a download="{{$attachment->attachment_file_name}}" href="{{aspBatchAttachmentImage($attachment->attachment_file_name,$attachment->entity_id)}}">
                                            Attachment {{$key+1}}
                                        </a>
                                    </div>
                                    @endforeach
                                </div>
                            </div>
                        </div>
                        @endif
                        <div class="viewData-accordion">
                        </div>
                    </div>
                </div>
            </div>
            @includeWhen(($batch->has_gst AND $invoice_details),'partials.batch.invoice_details1')
            @if($invoice_details)
            <div class="formTabs-wrapper">
                <label class="heading-label">Invoice Details </label>
                <div class="formTabs-inner">
                    <div class="formTabs-content">
                        <div class="tab-content">
                            <div id="" class="tab-pane fade in active">
                                <div class="form-wrapper">
                                    <div class="row">
                                        <div class="viewData-form--wrapper">
                                            <p class="p-l-20">
                                            </p>
                                            <table id="aspLogin-table" class="display table row_linked_table">
                                                <thead>
                                                    <tr class="no-link">
                                                        <th>Invoice Number</th>
                                                        <th>Invoice Date</th>
                                                        <th>Invoice Period</th>
                                                        <th>Asp Code</th>
                                                        <th>Workshop Name</th>
                                                        <th class="text-right">No of Tickets</th>
                                                        <th class="text-right">Invoice Amount</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach($invoice_details as $key => $invoice_detail)
                                                    <?php
//Route for Finance
if (Auth::user()->role_id == 9) {
    $route = 'getFinanceInvoicesView';
} else if (Auth::user()->role_id == 4) {
    $route = 'getAspInvoicesView';
} else {
    $route = 'getBoInvoicesView';
}

?>
                                                    <tr id="{{route($route,['invoice_id'=>$invoice_detail->id])}}">
                                                        <td>{{$invoice_detail->invoice_no}} - {{$invoice_detail->id}}</td>
                                                        <td>{{$invoice_detail->created_at}}</td>
                                                        <td>{{$invoice_detail->start_date}} - {{$invoice_detail->end_date}}</td>
                                                        <td>{{$invoice_detail->asp->asp_code}}</td>
                                                        <td>{{$invoice_detail->asp->workshop_name}}</td>
                                                        <td class="text-right">{{$invoice_detail->tickets()->count()}}</td>
                                                        <td class="text-right">{{number_format($invoice_detail->tickets()->sum('bo_invoice_amount'),2)}}</td>
                                                    </tr>
                                                    @endforeach
                                                </tbody>
                                            </table>
                                            <div class="clearfix"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @endif
            @if(isset($courier_details) and count($courier_details) > 0)
            <?php $active_courier = isset($active_courier) ? $active_courier : 0 ?>
            <div class="formTabs-wrapper">
                <label class="heading-label">Courier Details</label>
                <div class="formTabs-inner">
                    <div class="formTabs-header">
                        <ul class="nav nav-tabs">
                            @foreach($courier_details as $key => $courier_detail)
                            <li class="{{$key == $active_courier ? 'active' : ''}}">
                                <a data-toggle="tab" href="#{{$courier_detail->type == 1 ? 'inward' : 'outward'}}-tab">
                                    {{$courier_detail->type == 1 ? 'Inward' : 'Outward'}}
                                </a>
                            </li>
                            @endforeach
                        </ul>
                    </div>
                    <div class="formTabs-content">
                        <div class="tab-content">
                            @foreach($courier_details as $key => $courier_detail)
                            <?php $prefix = $courier_detail->type == 1 ? "iw_" : "ow_"; ?>
                            <div id="{{$courier_detail->type == 1 ? 'inward' : 'outward'}}-tab" class="tab-pane fade {{$key == $active_courier ? 'in active':''}}">
                                <div class="form-wrapper">
                                    <div class="row">
                                        <div class="col-xs-12 col-sm-4">
                                            <div class="form-group">
                                                <label>{{$courier_detail->type == 1 ? 'Received Date': 'Couriered Date'}}</label>
                                                <div class="clearfix"></div>
                                                @if($courier_detail->received_date == '01-01-1970')
                                                <?php echo Form::text($prefix.'received_date','',['placeholder'=>$courier_detail->type == 1 ? 'Received Date': 'Courier Date','class' => 'form-control form-input','autocomplete' => 'off']+$courier_editable[$key]); ?>
                                                @else
                                                <?php echo Form::text($prefix.'received_date',$courier_detail->received_date,['placeholder'=>$courier_detail->type == 1 ? 'Received Date': 'Courier Date','class' => 'form-control form-input date-picker','autocomplete' => 'off']+$courier_editable[$key]); ?>
                                                @endif
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-4">
                                            <div class="form-group">
                                                <label>Courier Name</label>
                                                <div class="clearfix"></div>
                                                <?php echo Form::text($prefix.'courier_name',$courier_detail->courier_name,['placeholder'=>'Courier Name','class' => 'form-control form-input','autocomplete' => 'off']+$courier_editable[$key]); ?>
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-4">
                                            <div class="form-group">
                                                <label>Waybill No</label>
                                                <div class="clearfix"></div>
                                                <?php echo Form::text($prefix.'waybill_no',$courier_detail->waybill_no,['placeholder'=>'Waybill Number','class' => 'form-control form-input','autocomplete' => 'off']+$courier_editable[$key]); ?>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @endforeach
                        </div>
                    </div>
                </div>
            </div>
            @endif
            <div class="formTabs-wrapper">
                <label class="heading-label">Payment Details</label>
                <div class="formTabs-inner">
                    <div class="formTabs-content">
                        <div class="tab-content">
                            <div id="" class="tab-pane fade in active">
                                <div class="form-wrapper">
                                    <div class="row">
                                        <div class="col-xs-12 col-sm-4">
                                            <div class="form-group">
                                                <label>Payment Date</label>
                                                <div class="clearfix"></div>
                                                <?php echo Form::text('payment_date', $batch->payment_date, ['class' => 'form-control form-input date-picker', 'placeholder' => 'Select Date', 'autocomplete' => 'off'] + $payment_editable); ?>
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-4">
                                            <div class="form-group">
                                                <label>UTR Number</label>
                                                <div class="clearfix"></div>
                                                <?php echo Form::textarea('utr_number', $batch->utr_number, ['class' => 'form-control form-input', 'placeholder' => 'Enter Transaction id', 'autocomplete' => 'off'] + $payment_editable); ?>
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-4">
                                            <div class="form-group">
                                                <label>TDS Amount</label>
                                                <div class="clearfix"></div>
                                                <?php echo Form::text('tds', $batch->tds, ['class' => 'form-control form-input', 'placeholder' => 'Enter Amount', 'autocomplete' => 'off'] + $payment_editable); ?>
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-4">
                                            <div class="form-group">
                                                <label>Paid Amount</label>
                                                <div class="clearfix"></div>
                                                <?php echo Form::text('paid_amount', $batch->paid_amount, ['class' => 'form-control form-input', 'placeholder' => 'Enter Amount', 'autocomplete' => 'off'] + $payment_editable); ?>
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-4">
                                            <div class="form-group">
                                                <label>Comments</label>
                                                <div class="clearfix"></div>
                                                <?php echo Form::textarea('comments', $batch->comments, ['class' => 'form-control form-input', 'placeholder' => 'Enter Amount', 'autocomplete' => 'off'] + $payment_editable); ?>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>